# Autoencoder Benchmark 报告

**Checkpoint**: `output/ae_test_10epochs/checkpoints/last.ckpt`
**数据集**: `data/ae_test_subset` (Test + OOD)
**日期**: 2024-12-05
**模型**: AE, latent_dim=512, hidden_dim=[4096, 2048, 1024]

---

## 汇总统计

| 数据集 | 样本数 | MSE | Correlation | Cosine Similarity | R² Score |
|--------|--------|-----|-------------|-------------------|----------|
| **Test** | 409,600 | 0.1045 ± 0.029 | 0.564 ± 0.157 | 0.574 ± 0.154 | 0.284 ± 0.228 |
| **OOD** | 409,600 | 0.1074 ± 0.029 | 0.555 ± 0.153 | 0.566 ± 0.150 | 0.274 ± 0.217 |

---

## 评估指标说明

### 1. MSE (均方误差)
- **定义**: 原始与重建基因表达之间的平均平方差
- **公式**: `MSE = mean((x - x_reconstructed)²)`
- **解释**: 越低越好，归一化数据通常在 0-1 之间
- **当前结果**: ~0.10，表示中等程度的重建误差

### 2. Pearson Correlation (皮尔逊相关系数)
- **定义**: 每个细胞的原始与重建表达谱之间的线性相关性
- **公式**: `corr = cov(x, x_rec) / (std(x) * std(x_rec))`
- **解释**: 范围 [-1, 1]，越高越好。>0.9 优秀，>0.7 良好
- **当前结果**: ~0.56，表示中等重建质量

### 3. Cosine Similarity (余弦相似度)
- **定义**: 原始与重建向量之间夹角的余弦值
- **公式**: `cos_sim = (x · x_rec) / (||x|| * ||x_rec||)`
- **解释**: 范围 [-1, 1]，越高越好，衡量方向相似性
- **当前结果**: ~0.57，与相关系数相近

### 4. R² Score (决定系数)
- **定义**: 重建所解释的原始数据方差比例
- **公式**: `R² = 1 - SS_res / SS_tot`
- **解释**: 范围 (-∞, 1]，越高越好，1.0 = 完美重建
- **当前结果**: ~0.28，表示方差解释能力有限

---

## 可视化输出说明

### 1. `correlation_distribution.png`
**描述**: 核密度估计 (KDE) 图，展示每个细胞皮尔逊相关系数的分布。

**内容**:
- X轴: 皮尔逊相关系数 (0 到 1)
- Y轴: 密度
- 蓝色曲线: Test 数据集分布
- 橙色曲线: OOD 数据集分布
- 虚线: 0.9 阈值（理想目标）

**洞察**:
- 主峰值在 0.6-0.7 附近
- 在 0.2 附近有次峰值（重建较差的细胞）
- Test 和 OOD 分布高度重叠

---

### 2. `mse_distribution.png`
**描述**: KDE 图，展示每个细胞 MSE 值的分布。

**内容**:
- X轴: 均方误差
- Y轴: 密度
- Test 和 OOD 数据集分别用不同曲线表示

**洞察**:
- 大多数细胞的 MSE 在 0.05-0.15 之间
- 存在向高 MSE 值延伸的长尾

---

### 3. `metrics_boxplot.png`
**描述**: 四个指标在 Test 和 OOD 数据集间的箱线图对比。

**内容**:
- 4 个子图: Correlation, MSE, Cosine Similarity, R² Score
- 绿色箱体: Test 数据集
- 橙色箱体: OOD 数据集
- 显示中位数、四分位数和异常值

**洞察**:
- Test 和 OOD 分布相似
- R² 有许多负异常值（部分细胞重建很差）
- Test 和 OOD 之间性能差距很小

---

### 4. `correlation_vs_mse.png`
**描述**: 散点图，展示每个细胞的相关系数与 MSE 之间的关系。

**内容**:
- X轴: 相关系数
- Y轴: MSE
- 按数据集着色 (Test vs OOD)

**洞察**:
- 指标之间呈负相关（符合预期）
- 低相关系数的细胞往往有高 MSE
- 密集聚类在中等质量区域

---

### 5. `latent_space_pca.png`
**描述**: 512 维潜在空间的 PCA 可视化，投影到 2D。

**内容**:
- 左图: 按重建相关系数着色（红色=低，绿色=高）
- 右图: 按总表达量着色（细胞大小代理）
- 坐标轴显示 PC1 和 PC2 及其方差解释比例

**洞察**:
- PC1 捕获了 100% 的方差（可能存在潜在空间坍塌问题）
- 潜在空间呈弯曲结构
- 低表达细胞（紫色）重建效果较差
- 高表达细胞（黄色）单独聚类

---

### 6. `reconstruction_examples.png`
**描述**: 不同相关系数水平的重建质量可视化示例。

**内容**:
- 上排: 原始 vs 重建表达散点图（6 个示例）
- 下排: 前 20 个高表达基因的柱状图对比
- 示例按相关系数从低到高排序 (0.295 → 0.755)
- 红色虚线: 完美重建线 (y=x)

**洞察**:
- 模型倾向于低估高表达值
- 中等表达的细胞重建效果更好
- 低相关系数的细胞表现出系统性偏差

---

## 输出文件列表

| 文件名 | 描述 |
|--------|------|
| `summary_stats.csv` | 各数据集的汇总统计 |
| `benchmark_metrics.csv` | 逐细胞指标 (409,600 × 2 行) |
| `correlation_distribution.png` | 相关系数分布图 |
| `mse_distribution.png` | MSE 分布图 |
| `metrics_boxplot.png` | 所有指标的箱线图对比 |
| `correlation_vs_mse.png` | 相关系数 vs MSE 散点图 |
| `latent_space_pca.png` | 潜在空间 PCA 可视化 |
| `reconstruction_examples.png` | 重建样例展示 |

---

## 结论

### 当前模型表现
- **中等重建质量** (Correlation ~0.56)
- **泛化能力良好** (Test ≈ OOD 表现)
- **潜在空间可能存在问题** (PC1 主导)

### 改进建议
1. 增加训练轮数 (当前: 10 → 建议: 50+)
2. 监控潜在空间坍塌问题
3. 考虑使用 VAE 或添加正则化
4. 调查低重建质量细胞的特征
